<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>香港麻雀沉浸式計番大腦</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#334155">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        /* ==== 核心環境 ==== */
        * { 
            box-sizing: border-box; margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            touch-action: manipulation; 
        }
        
        body {
            background-color: #334155; transition: background-color 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            color: #ffffff; display: flex; justify-content: center; min-height: 100vh; position: relative;
            padding-top: max(30px, env(safe-area-inset-top) + 10px); padding-right: 15px;
            padding-bottom: max(30px, env(safe-area-inset-bottom) + 10px); padding-left: 15px;
            /* 允許上下滑動，但禁止雙指縮放 */
            touch-action: pan-y;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; 
            -webkit-touch-callout: none; -webkit-tap-highlight-color: transparent;
        }
        
        body.success-mode { background-color: #1e3a8a; }
        body.limit-mode { background-color: #2e1065; }
        body.failure-mode { background-color: #7f1d1d; }

        .bg-layer {
            position: fixed; top: -20vh; left: -20vw; width: 140vw; height: 140vh; z-index: 0; pointer-events: none; 
            transition: opacity 1.5s cubic-bezier(0.4, 0, 0.2, 1); will-change: transform; transform: translateZ(0);
        }
        .bg-base {
            background-image: radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.5) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(20, 184, 166, 0.4) 0%, transparent 60%), radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 60%);
            animation: liquidFlow 15s ease-in-out infinite alternate; opacity: 1;
        }
        .bg-limit {
            background-image: radial-gradient(circle at 30% 30%, rgba(250, 204, 21, 0.6) 0%, transparent 70%), radial-gradient(circle at 70% 70%, rgba(236, 72, 153, 0.5) 0%, transparent 70%);
            animation: liquidFlow 12s ease-in-out infinite alternate-reverse; opacity: 0;
        }
        @keyframes liquidFlow { 0% { transform: translate3d(0%, 0%, 0) scale(1); } 100% { transform: translate3d(5%, 5%, 0) scale(1.05); } }
        body.limit-mode .bg-base { opacity: 0; } body.limit-mode .bg-limit { opacity: 1; } body.failure-mode .bg-base { opacity: 0; }

        .app-container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 18px; position: relative; z-index: 1; padding-bottom: 20px; }

        .glass-card {
            background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(8px) contrast(110%); -webkit-backdrop-filter: blur(8px) contrast(110%);
            border-radius: 28px; border: 1px solid rgba(255, 255, 255, 0.15); border-top: 1px solid rgba(255, 255, 255, 0.3); border-left: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), inset 0 1px 1px rgba(255, 255, 255, 0.1); 
            padding: 20px; transition: background-color 0.6s, border-color 0.6s, box-shadow 0.6s; transform: translateZ(0); 
        }

        .status-header { text-align: center; }
        .status-title { font-size: 13px; opacity: 0.7; letter-spacing: 2px; margin-bottom: 8px; text-transform: uppercase; font-weight: 500; color: rgba(255,255,255,0.8); }
        .score-display { font-size: 64px; font-weight: 200; line-height: 1; margin-bottom: 12px; color: #ffffff; text-shadow: 0 4px 20px rgba(0,0,0,0.3); font-variant-numeric: tabular-nums; }
        .pattern-name { font-size: 15px; font-weight: 500; min-height: 24px; display: flex; flex-wrap: wrap; justify-content: center; gap: 6px;}
        .pattern-tag { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); color: rgba(255,255,255,0.9); padding: 4px 12px; border-radius: 14px; font-size: 13px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .pattern-tag.highlight { background: rgba(250, 204, 21, 0.2); border-color: rgba(250, 204, 21, 0.5); color: #fde047; text-shadow: 0 0 10px rgba(250,204,21,0.4); }
        .pattern-tag.flower { background: rgba(244, 114, 182, 0.2); border-color: rgba(244, 114, 182, 0.5); color: #f9a8d4; }
        .pattern-tag.wind { background: rgba(56, 189, 248, 0.2); border-color: rgba(56, 189, 248, 0.5); color: #7dd3fc; }

        .conditions-area { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px 8px; }
        .condition-chip { padding: 10px 16px; border-radius: 24px; font-size: 13px; font-weight: 600; background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); border-top: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s ease; }
        .condition-chip.active { background: #3b82f6; color: #fff; border-color: #60a5fa; box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); transform: scale(1.05); }

        .section-header { font-size: 13px; opacity: 0.7; margin-bottom: 10px; display: flex; justify-content: space-between; font-weight: 500; color: rgba(255,255,255,0.8); }
        .winds-container { display: flex; gap: 15px; margin-bottom: 16px; }
        .wind-group { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .wind-selector { display: flex; gap: 6px; }
        .wind-btn { flex: 1; padding: 8px 0; text-align: center; border-radius: 10px; background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.15); font-size: 14px; cursor: pointer; transition: 0.2s; color: rgba(255,255,255,0.8); font-weight: 500; }
        .wind-btn.active { background: #ffffff; color: #1e293b; font-weight: bold; box-shadow: 0 2px 10px rgba(255,255,255,0.3); }

        .flower-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px; }
        .flower-tile { aspect-ratio: 3/4; background-color: #fdfdfd; border-radius: 6px; cursor: pointer; transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3), inset 0 -2px 0 rgba(0,0,0,0.1); background-size: 85%; background-position: center; background-repeat: no-repeat; }
        .flower-tile.active { transform: translate3d(0, -4px, 0); box