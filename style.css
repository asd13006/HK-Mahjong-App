/* ==== æ ¸å¿ƒç’°å¢ƒè¨­å®š ==== */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; touch-action: manipulation; }

body { background-color: #e0f2fe; color: #1e293b; display: flex; justify-content: center; min-height: 100vh; position: relative; padding-top: max(30px, env(safe-area-inset-top) + 10px); padding-right: 15px; padding-bottom: max(30px, env(safe-area-inset-bottom) + 10px); padding-left: 15px; touch-action: pan-y; -webkit-user-select: none; -moz-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; transition: color 0.8s ease; }

.bg-layer { position: fixed; inset: 0; z-index: -2; opacity: 0; transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1); pointer-events: none; }
.bg-base { background: linear-gradient(135deg, #e0f2fe 0%, #f3e8ff 50%, #fce7f3 100%); opacity: 1; }
.bg-success { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
.bg-limit { background: linear-gradient(135deg, #fef9c3 0%, #fde047 100%); }
.bg-failure { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }

body.success-mode .bg-base { opacity: 0; } body.success-mode .bg-success { opacity: 1; } body.success-mode { color: #172554; }
body.limit-mode .bg-base { opacity: 0; } body.limit-mode .bg-limit { opacity: 1; } body.limit-mode { color: #422006; }
body.failure-mode .bg-base { opacity: 0; } body.failure-mode .bg-failure { opacity: 1; } body.failure-mode { color: #450a0a; }

.app-container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 18px; position: relative; z-index: 1; padding-bottom: 20px; flex: 1; }

.glass-card { position: relative; backdrop-filter: blur(20px) saturate(120%); -webkit-backdrop-filter: blur(20px) saturate(120%); border-radius: 28px; border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 8px 32px rgba(31, 38, 135, 0.10), inset 0 1px 1px rgba(255, 255, 255, 0.8); padding: 20px; transform: translateZ(0); z-index: 1; transition: border-color 0.8s ease, box-shadow 0.8s ease, transform 0.3s ease; }
.glass-card::before { content: ""; position: absolute; inset: 0; border-radius: inherit; z-index: -1; background-color: rgba(255, 255, 255, 0.5); transition: background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1); will-change: background-color; }

body.success-mode #statusCard { border-color: rgba(147, 197, 253, 0.8); box-shadow: 0 12px 36px rgba(59, 130, 246, 0.2), inset 0 1px 1px rgba(255, 255, 255, 0.5); } body.success-mode #statusCard::before { background-color: rgba(219, 234, 254, 0.7); }
body.limit-mode #statusCard { border-color: rgba(253, 224, 71, 0.8); box-shadow: 0 12px 36px rgba(234, 179, 8, 0.2), inset 0 2px 15px rgba(250, 204, 21, 0.3); } body.limit-mode #statusCard::before { background-color: rgba(254, 249, 195, 0.7); }
body.failure-mode #statusCard { border-color: rgba(252, 165, 165, 0.8); box-shadow: 0 12px 36px rgba(239, 68, 68, 0.2), inset 0 1px 1px rgba(255, 255, 255, 0.5); } body.failure-mode #statusCard::before { background-color: rgba(254, 226, 226, 0.7); }

.status-title, .score-display, .pattern-name { transition: opacity 0.25s ease, transform 0.25s ease, color 0.3s ease; }
.content-fade-out .status-title, .content-fade-out .score-display, .content-fade-out .pattern-name { opacity: 0; transform: scale(0.95); }

.status-header { text-align: center; }
.status-title { font-size: 13px; opacity: 0.6; letter-spacing: 2px; margin-bottom: 8px; text-transform: uppercase; font-weight: 600; color: #64748b; }

/* ğŸ”¥ ä¿®æ­£ 1ï¼šè¨ˆåˆ†æ¿æ°´å¹³åŸºæº–ç·šå°é½Š (Baseline Alignment) è§£æ±ºåœ–å››å•é¡Œ */
.score-display { 
    display: flex; align-items: baseline; justify-content: center; gap: 4px;
    font-size: 64px; font-weight: 300; line-height: 1; margin-bottom: 12px; color: #0f172a; text-shadow: 0 2px 10px rgba(0,0,0,0.05); font-variant-numeric: tabular-nums; 
}
.score-display span:last-child { margin-left: 0 !important; } /* æŠµéŠ· HTML è£¡çš„ marginï¼Œæ”¹ç”¨ flex gap */

.heartbeat-pop { animation: heartbeat 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; will-change: transform; }
@keyframes heartbeat { 0% { transform: scale(1); } 40% { transform: scale(1.15); } 100% { transform: scale(1); } }

.pattern-name { font-size: 15px; font-weight: 500; min-height: 24px; display: flex; flex-wrap: wrap; justify-content: center; gap: 6px;}

.pattern-tag { background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(255, 255, 255, 0.8); color: #334155; padding: 4px 12px; border-radius: 14px; font-size: 13px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-weight: 600; opacity: 0; transform: scale(0.8) translateY(10px); animation: tagSpringIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; will-change: transform, opacity; }
@keyframes tagSpringIn { 100% { opacity: 1; transform: scale(1) translateY(0); } }
.pattern-tag.highlight { background: rgba(250, 204, 21, 0.3); border-color: rgba(250, 204, 21, 0.6); color: #854d0e; }
.pattern-tag.flower { background: rgba(244, 114, 182, 0.3); border-color: rgba(244, 114, 182, 0.6); color: #9d174d; }
.pattern-tag.wind { background: rgba(56, 189, 248, 0.3); border-color: rgba(56, 189, 248, 0.6); color: #0c4a6e; }

.dynamic-island { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(20px) saturate(150%); -webkit-backdrop-filter: blur(20px) saturate(150%); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08), inset 0 1px 1px rgba(255, 255, 255, 0.8); border-radius: 30px; margin: 0 auto; width: 100%; max-width: 180px; display: flex; flex-direction: column; overflow: hidden; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); will-change: max-width, border-radius; color: #334155; }
.dynamic-island.expanded { max-width: 420px; border-radius: 28px; background: rgba(255, 255, 255, 0.6); }
.island-header { padding: 12px 20px; display: flex; justify-content: center; align-items: center; gap: 8px; cursor: pointer; user-select: none; }

.island-title { font-size: 13px; font-weight: 700; color: #475569; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease, color 0.3s ease; }
.island-title.slide-out { transform: translateY(-10px); opacity: 0; transition: transform 0.2s ease-in, opacity 0.2s ease-in; }
.island-title.slide-in { transform: translateY(10px); opacity: 0; transition: none; }

.island-chevron { font-size: 10px; opacity: 0.6; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); color: #64748b; }
.dynamic-island.expanded .island-chevron { transform: rotate(-180deg); }
.island-content-grid { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
.dynamic-island.expanded .island-content-grid { grid-template-rows: 1fr; }
.island-content-inner { min-height: 0; overflow: hidden; display: flex; flex-direction: column; }
.island-section { padding: 0 16px 16px 16px; opacity: 0; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
.dynamic-island.expanded .island-section { opacity: 1; transform: translateY(0); }
.dynamic-island.expanded .island-section:nth-child(1) { transition-delay: 0.05s; }
.dynamic-island.expanded .island-section:nth-child(3) { transition-delay: 0.10s; }
.dynamic-island.expanded .island-section:nth-child(5) { transition-delay: 0.15s; }
.island-divider { height: 1px; background: rgba(0, 0, 0, 0.06); margin: 0 16px 12px 16px; opacity: 0; transition: opacity 0.3s; }
.dynamic-island.expanded .island-divider { opacity: 1; }
.island-section-header { font-size: 12px; opacity: 0.8; margin-bottom: 10px; display: flex; justify-content: space-between; font-weight: 700; color: #475569; letter-spacing: 1px; }

/* ğŸ”¥ ä¿®æ­£ 2ï¼šåŠ å…¥ minmax(0, 1fr) èˆ‡æº¢å‡ºéš±è—ï¼Œè§£æ±ºåœ–äºŒ/åœ–ä¸‰çš„ç‰ˆé¢æ’ç ´å•é¡Œ */
.conditions-wrapper { 
    display: grid; 
    grid-template-columns: repeat(6, minmax(0, 1fr)); 
    gap: 8px; 
}
.condition-chip { 
    padding: 8px 2px; /* ç¸®å°å·¦å³å…§é‚Šè·ï¼Œçµ¦æ–‡å­—æ›´å¤šç©ºé–“ */
    border-radius: 20px; font-size: 11px; font-weight: 600; background: rgba(255, 255, 255, 0.5); border: 1px solid rgba(255, 255, 255, 0.8); color: #64748b; cursor: pointer; display: flex; align-items: center; justify-content: center; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; /* é¿å…è¶…é•·æ–‡å­—æ’ç ´ç¶²æ ¼ */
    letter-spacing: -0.2px; grid-column: span 2; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s, border-color 0.2s, color 0.2s, box-shadow 0.2s; will-change: transform; 
}
.condition-chip.active { background: #3b82f6; color: #fff; border-color: #60a5fa; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); transform: scale(1.05); }
.condition-chip:nth-child(7), .condition-chip:nth-child(8) { grid-column: span 3; }
@media (max-width: 380px) { .condition-chip { font-size: 10px; letter-spacing: -0.5px; } }

.winds-container { display: flex; gap: 15px; }
.wind-group { flex: 1; display: flex; flex-direction: column; gap: 8px; }
.wind-selector { display: flex; gap: 6px; }
.wind-btn { flex: 1; padding: 6px 0; text-align: center; border-radius: 8px; background: rgba(255,255,255,0.5); border: 1px solid rgba(255,255,255,0.8); font-size: 13px; cursor: pointer; color: #64748b; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s, color 0.2s, box-shadow 0.2s, border-color 0.2s; will-change: transform; }
.wind-btn.active { background: #ffffff; color: #0f172a; font-weight: 800; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: #fff; }

.flower-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; padding: 6px 4px; }
.flower-tile { position: relative; z-index: 1; aspect-ratio: 3/4; background-color: #fcfaf9; border-radius: 8px; cursor: pointer; box-shadow: 0 6px 12px rgba(0,0,0,0.08), inset 0 -2px 1px rgba(0,0,0,0.05); background-size: 88%; background-position: center; background-repeat: no-repeat; overflow: hidden; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.4s ease; will-change: transform, box-shadow, backdrop-filter; }
.flower-tile.active { transform: scale(1.08) translateY(-2px); z-index: 10; background-color: transparent; backdrop-filter: url(#liquid-fx) saturate(180%) blur(0.5px); -webkit-backdrop-filter: url(#liquid-fx) saturate(180%) blur(0.5px); box-shadow: inset 0 0 0 1px rgba(255,255,255, 0.9), inset 0 1px 3px rgba(255,255,255, 0.8), 0 12px 24px rgba(0,0,0,0.15); }
.flower-tile::after { content: ""; position: absolute; inset: 0; border-radius: 8px; background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 40%, rgba(255,255,255,0) 100%); opacity: 0; transition: opacity 0.3s ease; pointer-events: none; mix-blend-mode: overlay; }
.flower-tile.active::after { opacity: 1; }

.hand-container { min-height: 120px; }
.hand-header { display: flex; justify-content: space-between; align-items: center; font-size: 13px; opacity: 0.8; margin-bottom: 12px; font-weight: 600; color: #475569; }
.tiles-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
.tiles-grid::after { content: ""; grid-column: 1; grid-row: 3; aspect-ratio: 3/4; pointer-events: none; visibility: hidden; }

@keyframes popIn { 0% { opacity: 0; transform: scale(0.6) translate3d(0, 20px, 0); } 100% { opacity: 1; transform: scale(1) translate3d(0, 0, 0); } }
.enter-anim { animation: popIn 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; will-change: transform, opacity; }
@keyframes slotExpand { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
.empty-enter-anim { animation: slotExpand 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; will-change: transform, opacity; }

.breathing { animation: floatBreathing 3s ease-in-out infinite alternate; }
@keyframes floatBreathing { 0% { transform: translateY(0px); } 100% { transform: translateY(-3px); } }

/* ğŸ”¥ ä¿®æ­£ 3ï¼šå¼·åˆ¶ç§»é™¤éµç›¤ä¸Šæ–¹ç©ºéš™ï¼Œè§£æ±ºåœ–ä¸€å•é¡Œ */
.keyboard { 
    display: flex; flex-direction: column; gap: 8px; 
    margin-top: 0 !important; /* ç¢ºä¿æ²’æœ‰ä»»ä½•å¤šé¤˜çš„ margin å°‡å®ƒæ¨ä¸‹å» */
}
.suit-row { display: grid; grid-template-columns: repeat(9, 1fr); gap: 5px; }

.tile { aspect-ratio: 3/4; background-color: #fcfaf9; border-radius: 6px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1), inset 0 -2px 1px rgba(0,0,0,0.05); width: 100%; height: auto; background-size: 85%; background-position: center; background-repeat: no-repeat; color: #1e293b; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s; will-change: transform; }
.is-tapped-tile { animation: none !important; transform: translate3d(0, 2px, 0) scale(0.92) !important; box-shadow: 0 1px 2px rgba(0,0,0,0.1), inset 0 -1px 0 rgba(0,0,0,0.05) !important; transition: none !important; }
.is-tapped-chip { transform: scale(0.92) !important; transition: none !important; opacity: 0.8; }
.is-tapped-island { transform: scale(0.96) translateZ(0) !important; transition: none !important; }

.tile.empty { background-image: none !important; background-color: rgba(255,255,255,0.3); box-shadow: inset 0 2px 6px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.4); cursor: default; }
.clear-btn { background: rgba(255, 255, 255, 0.6) !important; border: 1px solid rgba(255, 255, 255, 0.8) !important; border-radius: 20px !important; color: #475569 !important; padding: 5px 12px !important; font-size: 12px !important; line-height: 1 !important; font-weight: 600 !important; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s, border-color 0.2s, color 0.2s; will-change: transform; }

.install-btn { background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 12px 24px; border-radius: 20px; font-size: 15px; font-weight: 600; letter-spacing: 1px; cursor: pointer; display: none; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3), inset 0 1px 1px rgba(255,255,255,0.4); margin: 10px auto 0 auto; backdrop-filter: blur(10px); transition: transform 0.2s ease; position: relative; overflow: hidden; }
.install-btn::before { content: ""; position: absolute; top: 0; left: -150%; width: 50%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0) 100%); transform: skewX(-25deg); animation: diamondShimmer 6s infinite; pointer-events: none; }
@keyframes diamondShimmer { 0% { left: -150%; } 15% { left: 200%; } 100% { left: 200%; } }

.footer-credit { text-align: center; font-size: 11px; font-weight: 400; color: #94a3b8; letter-spacing: 0.5px; margin-bottom: 5px; display: flex; flex-direction: column; gap: 4px; margin-top: auto !important; padding-top: 20px; }
.version-num { font-size: 10px; opacity: 0.8; }

#statusCard::after { content: ""; position: absolute; inset: -2px; border-radius: inherit; z-index: -2; pointer-events: none; box-shadow: 0 0 30px rgba(125, 211, 252, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.6); opacity: 0; transition: opacity 0.8s ease; }
body:not(.success-mode):not(.limit-mode):not(.failure-mode) #statusCard::after { animation: ambientBreath 5s cubic-bezier(0.4, 0, 0.6, 1) infinite alternate; }
@keyframes ambientBreath { 0% { opacity: 0.1; transform: scale(0.995); } 100% { opacity: 0.8; transform: scale(1.01); } }

@keyframes jellySquish { 0% { transform: scaleY(1) translateZ(0); } 30% { transform: scaleY(0.96) translateZ(0); } 100% { transform: scaleY(1) translateZ(0); } }
@keyframes jellyStretch { 0% { transform: scaleY(1) translateZ(0); } 30% { transform: scaleY(1.03) translateZ(0); } 100% { transform: scaleY(1) translateZ(0); } }
.jelly-squish { animation: jellySquish 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: top center; }
.jelly-stretch { animation: jellyStretch 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: top center; }
#keyboard.jelly-squish, #keyboard.jelly-stretch { animation-delay: 0.05s; }

/* ==== âœ¨ v2.6.0ï¼šå‹•æ…‹å³¶ã€Œç³»çµ±æ›´æ–°ã€ç‹€æ…‹è®Šèº« ==== */
.dynamic-island.update-ready {
    border-color: rgba(234, 179, 8, 0.6); /* è®ŠæˆæŸ”å’Œçš„é‡‘è‰²é‚Šæ¡† */
    /* åŠ å…¥é‡‘è‰²çš„å¾…æ©Ÿå‘¼å¸å…‰ */
    animation: islandUpdateBreathe 2s cubic-bezier(0.4, 0, 0.6, 1) infinite alternate;
}

/* ==== âœ¨ v2.6.2ï¼šå‹•æ…‹å³¶ã€Œç³»çµ±æ›´æ–°ã€ç‹€æ…‹çš„æ©«å‘å½ˆæ€§æ‹‰ä¼¸ ==== */
.dynamic-island.update-ready:not(.expanded) {
    max-width: 280px; /* çµ¦äºˆè¶³å¤ çš„å¯¬åº¦ï¼Œå®Œç¾å®¹ç´æ•´å¥æ›´æ–°æ–‡å­— */
}

@keyframes islandUpdateBreathe {
    0% { box-shadow: 0 8px 24px rgba(234, 179, 8, 0.15), inset 0 1px 1px rgba(255, 255, 255, 0.8); }
    100% { box-shadow: 0 8px 36px rgba(234, 179, 8, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.8); }
}